<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Intentional Strangers — Slow Dating by Letter</title>
  <meta name="description" content="A slow dating experience via handwritten letters. Human-curated matches, privacy by design. Vancouver pilot now open." />
  <meta property="og:title" content="Intentional Strangers — Slow Dating by Letter" />
  <meta property="og:description" content="Handwritten letters. Human-curated matches. Privacy by design." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/og-image.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Inter:wght@400;600&family=Patrick+Hand&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind layers -->
  <style type="text/tailwindcss">
    @layer base {
      :root { --brand:#4A423A; --brand-2:#3D352E; --paper:#FDF8F0; --ink:#3D352E; --accent:#C0392B; --sand:#EAE2D6; --muted:#6F655B; }
      html { scroll-behavior: smooth; }
      body { @apply bg-[var(--paper)] text-[var(--ink)] font-sans antialiased; font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
      h1,h2,h3,h4,h5,h6 { font-family: 'Lora', ui-serif, Georgia, serif; }
      .lora-font { font-family: 'Lora', ui-serif, Georgia, serif; }
      .hand-font { font-family: 'Patrick Hand', ui-rounded, system-ui; }
      a,button { @apply outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)] focus-visible:rounded; }
    }
    @layer components {
      .btn-primary { @apply bg-[var(--brand)] text-[var(--paper)] px-6 py-3 rounded-full shadow hover:bg-[var(--brand-2)] transition-colors duration-300 inline-flex items-center justify-center; }
      .btn-secondary { @apply border border-[var(--brand)] text-[var(--brand)] px-5 py-2 rounded-full hover:bg-[var(--brand)] hover:text-[var(--paper)] transition-colors duration-300 inline-flex items-center justify-center; }
      .section { @apply py-24 px-4; }
      .input { @apply w-full p-3 rounded-md border border-gray-300 focus:ring-2 focus:ring-[var(--accent)] focus:outline-none transition bg-white/90; }
      .label { @apply block text-lg lora-font mb-2; }
      .help { @apply text-sm text-[var(--muted)]; }
      .pill { @apply text-xs px-2 py-1 rounded-full border border-gray-300; }
      .card { @apply bg-white/70 rounded-xl shadow-inner border border-gray-200; }
    }
    @layer utilities {
      .fade-in { @apply opacity-0 translate-y-3 transition-all duration-700 ease-out; }
      .fade-in.visible { @apply opacity-100 translate-y-0; }
    }
  </style>

  <!-- Raw CSS -->
  <style>
    /* Envelope construction */
    .envelope-container { width: 320px; height: 220px; position: relative; perspective: 1000px; }
    .envelope { position:absolute; inset:0; background: linear-gradient(#f7efe5, #efe4d6); border:1px solid #dbcdbb; border-radius:8px; box-shadow:0 6px 24px rgba(0,0,0,.08); }
    .envelope-flap { position:absolute; top:0; left:0; right:0; height:60%; background:linear-gradient(#f2e7d8,#e9dece);
      clip-path: polygon(0 0, 100% 0, 50% 100%); transform-origin: top; transition: transform .6s ease-in-out; z-index:10; }
    .wax-seal { position:absolute; width:40px; height:40px; background-color: var(--accent); border-radius:50%; top:80px; left:50%;
      transform:translateX(-50%); z-index:11; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; letter-spacing:.5px; }
    .letter { position:absolute; top:8px; left:8px; right:8px; bottom:8px; background:var(--paper); border-radius:6px; padding:18px 18px 22px;
      box-shadow: inset 0 0 10px rgba(0,0,0,.06); transform: translateY(60%); opacity:0; transition: transform .7s .15s, opacity .7s .15s; z-index:5; overflow:auto; }
    .envelope-container.open .envelope-flap { transform: rotateX(180deg); }
    .envelope-container.open .letter { transform: translateY(0); opacity:1; }
    .envelope-container.open .wax-seal { opacity:0; pointer-events:none; transform: scale(0.95); transition: opacity .3s ease; }
    /* Range styling */
    input[type="range"] { width: 100%; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 9999px; background: var(--brand); cursor: pointer; }
    input[type="range"]::-webkit-slider-runnable-track { height: 4px; background: #e5e7eb; border-radius: 9999px; }
    @media (prefers-reduced-motion: reduce) { .fade-in, .envelope-flap, .letter { transition: none !important; } }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="py-6 px-4 sm:px-8 flex justify-between items-center">
    <p class="text-2xl lora-font font-medium">Intentional Strangers</p>
    <nav class="flex items-center gap-4">
      <a href="#how-it-works" class="hidden sm:inline hover:text-[var(--accent)]">How It Works</a>
      <a href="#pledge" class="hidden sm:inline hover:text-[var(--accent)]">Our Pledge</a>
      <a href="#signup" class="btn-secondary text-sm">Create Profile</a>
    </nav>
  </header>

  <!-- Hero -->
  <main class="text-center section pt-16">
    <h1 class="text-4xl md:text-6xl lora-font font-semibold leading-tight max-w-3xl mx-auto">Your Next Chapter Begins with a Letter.</h1>
    <p class="mt-6 text-lg max-w-2xl mx-auto text-[var(--muted)]">A slow dating experience for those who value words over algorithms. We connect thoughtful souls through the lost art of handwritten letters, fostering connections that are patient, private, and profound.</p>

    <div class="mt-10">
      <a href="#signup" class="btn-primary">Create Your Profile</a>
    </div>
  </main>

  <!-- How It Works -->
  <section id="how-it-works" class="section bg-[var(--sand)]">
    <div class="text-center max-w-4xl mx-auto">
      <h2 class="text-3xl md:text-4xl lora-font mb-4">The Art of Slow Dating</h2>
      <p class="text-lg text-[var(--muted)] mb-16">A simple, intentional process to rediscover romance.</p>

      <div class="grid md:grid-cols-3 gap-12 text-left">
        <div class="fade-in">
          <div class="lora-font text-5xl text-[var(--accent)] mb-4">1.</div>
          <h3 class="text-2xl lora-font mb-2">Share Your Story</h3>
          <p class="text-[var(--muted)]">You begin not with a profile, but with a conversation. Our thoughtful questionnaire goes beyond surface-level details, helping us understand the values, quirks, and dreams that make you, you.</p>
        </div>
        <div class="fade-in" style="transition-delay:200ms">
          <div class="lora-font text-5xl text-[var(--accent)] mb-4">2.</div>
          <h3 class="text-2xl lora-font mb-2">A Thoughtful Match</h3>
          <p class="text-[var(--muted)]">No algorithms, just human intuition. Based on your story, we find another soul whose narrative resonates with yours. We believe the best connections are curated with care, not code.</p>
        </div>
        <div class="fade-in" style="transition-delay:400ms">
          <div class="lora-font text-5xl text-[var(--accent)] mb-4">3.</div>
          <h3 class="text-2xl lora-font mb-2">Begin Your Correspondence</h3>
          <p class="text-[var(--muted)]">A beautifully prepared letter pack arrives at your door. Inside, you'll find everything you need to begin. Your privacy is paramount; addresses are always anonymous, relayed through our secure hub.</p>
        </div>
      </div>

      <div class="mt-12">
        <a href="#signup" class="btn-primary">Be a part of the Vancouver Pilot</a>
      </div>
    </div>
  </section>

  <!-- Rediscover Anticipation -->
  <section class="section text-center">
    <h2 class="text-3xl md:text-4xl lora-font mb-4">Rediscover the Magic of Anticipation</h2>
    <p class="text-lg text-[var(--muted)] mb-10 max-w-2xl mx-auto">The weight of an envelope. The unique curve of another's handwriting. The gentle pause before you unfold their words. Romance can be slow—and that’s the point.</p>

    <!-- Envelope directly below this copy -->
    <div class="mt-12 flex justify-center">
      <button id="envelope" class="envelope-container group" aria-expanded="false" aria-controls="letter-panel" type="button">
        <div class="envelope" aria-hidden="true"></div>
        <div class="envelope-flap" aria-hidden="true"></div>
        <div class="wax-seal" aria-hidden="true">IS</div>
        <div id="letter-panel" class="letter text-left">
          <p class="hand-font text-xl leading-7 text-[rgba(0,0,0,.8)]">Dear Stranger,</p>
          <p class="hand-font text-xl leading-7 mt-2 text-[rgba(0,0,0,.75)]">What a beautiful idea this is... I am so glad to have been matched and finally get to know someone deeply. The swiping was killing me to be honest...</p>
        </div>
      </button>
    </div>
    <p id="envelope-cta" class="mt-4 text-sm text-[var(--muted)] transition-opacity duration-500">(Press Enter or click the envelope to open)</p>
  </section>

  <!-- Our Pledge -->
  <section id="pledge" class="section bg-[var(--sand)]">
    <div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-12 items-center">
      <div class="fade-in">
        <h2 class="text-3xl md:text-4xl lora-font mb-6">Our Pledge to This Community</h2>
        <div class="space-y-4 text-[var(--muted)]">
          <p>✓ <span class="font-semibold">Patience &amp; Presence:</span> We encourage thoughtful replies, not instant reactions. This is a space to disconnect and be present.</p>
          <p>✓ <span class="font-semibold">Authenticity Over Perfection:</span> Your true self is more interesting than a polished profile. Share your honest thoughts and stories.</p>
          <p>✓ <span class="font-semibold">Privacy by Design:</span> Your personal contact details are never shared. We handle the logistics so you can focus on the connection.</p>
          <p>✓ <span class="font-semibold">Kindness is Mandatory:</span> Every stranger is a person with a story. We have a zero-tolerance policy for disrespect.</p>
        </div>
      </div>
      <div class="fade-in p-8 bg-[var(--paper)] rounded-lg shadow-lg" style="transition-delay:200ms">
        <p class="text-2xl lora-font leading-relaxed text-center">"We ask that you exchange at least <span class="text-[var(--accent)] font-bold">three letters</span> before sharing personal social media or phone numbers. Let the connection build on words first."</p>
      </div>
    </div>
  </section>

  <!-- Create Profile (Sign up) -->
  <section id="signup" class="section">
    <div class="max-w-xl mx-auto">
      <h2 class="text-3xl md:text-4xl lora-font mb-2">Create Your Profile</h2>
      <p class="text-[var(--muted)]">Sign up with your email and a password. You’ll then complete a short, meaningful set of questions to help us match you with the right Intentional Stranger.</p>

      <form id="signup-form" class="card p-6 mt-6" novalidate>
        <label for="su-email" class="label">Email</label>
        <input id="su-email" name="email" type="email" class="input" required autocomplete="email" placeholder="you@example.com">

        <div class="mt-4">
          <label for="su-password" class="label">Password</label>
          <div class="relative">
            <input id="su-password" name="password" type="password" class="input pr-24" required minlength="8" placeholder="At least 8 characters" autocomplete="new-password" aria-describedby="pw-help">
            <button type="button" id="toggle-pw" class="absolute right-2 top-1/2 -translate-y-1/2 btn-secondary px-3 py-1 text-sm">Show</button>
          </div>
          <p id="pw-help" class="help mt-1">Use 8+ characters. Add a number or symbol for extra strength.</p>
        </div>

        <button type="submit" class="btn-primary mt-6 w-full">Create account & continue</button>
        <p class="help mt-3">By creating an account you agree to our community standards and privacy policy.</p>
      </form>
    </div>
  </section>

  <!-- Questions Wizard -->
  <section id="questions" class="section bg-[var(--sand)] hidden">
    <div class="max-w-3xl mx-auto">
      <h2 class="text-3xl md:text-4xl lora-font mb-2">Tell Us About You</h2>
      <p class="text-[var(--muted)]">We implore you to take your time on the following questions and be as descriptive as possible – this will allow you to be better matched with an intentional stranger that is just right for you. You may skip questions which do not resonate with you or you struggle to have an answer for. However, the more questions answered, the better match we can find for you! It would be best if you had around 30 minutes to populate your profile… I know, scrolling is so much easier, right? But the most meaningful connections are rarely found in a feed. The most intentional connections start here, with half an hour of your time.</p>

      <div class="card p-6 mt-6">
        <!-- Progress -->
        <div class="flex items-center justify-between mb-4">
          <div id="q-progress-label" class="text-sm text-[var(--muted)]">Question 1 of 1</div>
          <div class="w-40 h-2 bg-gray-200 rounded-full overflow-hidden">
            <div id="q-progress-bar" class="h-full bg-[var(--brand)]" style="width: 0%"></div>
          </div>
        </div>

        <!-- Question container -->
        <form id="q-form">
          <div id="q-body" class="space-y-3">
            <!-- injected dynamically -->
          </div>

          <div class="flex flex-wrap gap-3 mt-6">
            <button type="button" id="q-back" class="btn-secondary">Back</button>
            <button type="button" id="q-skip" class="btn-secondary">Skip</button>
            <button type="submit" id="q-next" class="btn-primary">Next</button>
          </div>
        </form>
      </div>

      <!-- Review -->
      <div id="q-review" class="card p-6 mt-6 hidden">
        <h3 class="lora-font text-2xl mb-2">Review Your Answers</h3>
        <p class="help mb-4">Scroll through to double-check. You can always go back.</p>
        <div id="q-review-list" class="space-y-4"></div>
        <button id="q-submit" class="btn-primary mt-6 w-full">Submit Profile</button>
        <p class="help mt-3">On submit, we’ll store your responses (placeholder) and email you next steps.</p>
      </div>
    </div>
  </section>

  <!-- Waitlist CTA (kept for marketing) -->
  <section id="waitlist" class="section text-center">
    <h2 class="text-3xl md:text-4xl lora-font mb-4">Become a Founding Member</h2>
    <p class="text-lg text-[var(--muted)] max-w-2xl mx-auto">Our Vancouver pilot is beginning soon. The first 150 members will help shape our community and receive their first letter pack on us.</p>
    <p class="text-lg text-[var(--muted)] max-w-3xl mx-auto mt-4">
      You will then receive an email directing you towards an in-depth analysis of you as a person. Your morals, values, interests, hobbies, and any strong preferences you have.<br>
      We believe anyone willing to partake in this journey, and dedicate the time to populising the questionnaire, shows a real intention to find love. There is no instant gratification, superficial swiping or hookup culture here.
    </p>
  </section>

  <!-- Footer -->
  <footer class="text-center py-12 px-4 border-t border-[var(--sand)]">
    <p class="lora-font text-xl">Intentional Strangers</p>
    <p class="mt-2 text-sm text-[var(--muted)]">© 2025. Made in Vancouver for thoughtful souls everywhere.</p>
  </footer>

  <script>
    /* ---------- Envelope interactions ---------- */
    const envelopeBtn = document.getElementById('envelope');
    const envelopeCta = document.getElementById('envelope-cta');
    const wax = envelopeBtn ? envelopeBtn.querySelector('.wax-seal') : null;

    envelopeBtn?.addEventListener('click', () => {
      const open = envelopeBtn.classList.toggle('open');
      envelopeBtn.setAttribute('aria-expanded', String(open));
      if (wax) wax.setAttribute('aria-hidden', open ? 'true' : 'false');
      if (envelopeCta) envelopeCta.style.opacity = open ? '0' : '1';
    });
    envelopeBtn?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); envelopeBtn.click(); }
    });

    /* ---------- Fade-in on scroll ---------- */
    const faders = document.querySelectorAll('.fade-in');
    const io = ('IntersectionObserver' in window) ? new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); obs.unobserve(entry.target); } });
    }, { threshold: 0.2, rootMargin: '0px 0px -50px 0px' }) : null;
    faders.forEach(el => io ? io.observe(el) : el.classList.add('visible'));

    /* ---------- Signup → Questions ---------- */
    const signupForm = document.getElementById('signup-form');
    const togglePw = document.getElementById('toggle-pw');
    const pwInput = document.getElementById('su-password');
    togglePw?.addEventListener('click', () => {
      const isPw = pwInput.type === 'password';
      pwInput.type = isPw ? 'text' : 'password';
      togglePw.textContent = isPw ? 'Hide' : 'Show';
    });

    signupForm?.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!signupForm.checkValidity()) { signupForm.reportValidity(); return; }
      const email = document.getElementById('su-email').value.trim();
      const pw = document.getElementById('su-password').value;
      // Placeholder: normally POST to /api/signup
      localStorage.setItem('is_signup_complete', 'true');
      localStorage.setItem('signup_email', email);
      // “Redirect” to questions
      document.getElementById('questions').classList.remove('hidden');
      window.location.hash = '#questions';
      initWizard();
    });

    /* ---------- Questions Wizard Engine ---------- */

    // Utility: make a question step
    const step = (id, label, html, required=false, help='') => ({ id, label, html, required, help });

    // Radio helper
    const radios = (name, options) =>
      options.map(o => `
        <label class="inline-flex items-center gap-2 mr-4">
          <input type="radio" name="${name}" value="${o}" class="accent-[var(--brand)]">
          <span>${o}</span>
        </label>`).join('');

    // Range group helper (importance matrix)
    const rangeRow = (name, label) => `
      <div class="flex items-center gap-4">
        <div class="w-48">${label}</div>
        <input type="range" name="${name}" min="1" max="5" value="3">
        <div class="text-sm text-[var(--muted)] w-24 text-right">1–5</div>
      </div>`;

    // Checkbox list helper
    const checkboxes = (name, opts) => opts.map(o => `
      <label class="flex items-center gap-2">
        <input type="checkbox" name="${name}" value="${o}" class="accent-[var(--brand)]">
        <span>${o}</span>
      </label>`).join('');

    // Steps definition (one-at-a-time)
    const QUESTIONS = [
      // Warm intro, like homepage “First, what’s your first name?”
      step('name', "First, what's your first name?", `
        <input class="input" type="text" name="name" placeholder="e.g. Alex" required>
      `, true, '1*1 style: one question per screen.'),

      step('age', "Age", `<input class="input" type="number" name="age" min="18" max="120" placeholder="e.g. 31">`),

      step('sexuality', "Sexuality", `
        <select class="input" name="sexuality">
          <option value="">Prefer not to say</option>
          <option>Straight</option>
          <option>Gay</option>
          <option>Lesbian</option>
          <option>Bisexual</option>
          <option>Pansexual</option>
          <option>Asexual</option>
          <option>Queer</option>
          <option>Questioning</option>
          <option>Other</option>
        </select>
      `),

      step('core_value', "What is one core value you try to live by?", `
        <input class="input" type="text" name="core_value" placeholder="e.g., Curiosity, Honesty, Adventure, Kindness">
      `),

      step('intro_extro', "Introvert, extrovert, or ambivert?", `
        <div class="space-y-2">
          <div>${radios('sociotype', ['Introvert','Extrovert','Ambivert','Not sure'])}</div>
          <textarea class="input" name="sociotype_notes" rows="4" placeholder="Have you noticed changes as you’ve gotten older?"></textarea>
        </div>
      `),

      step('growth', "Which have played an important role in your personal growth? (Select all that apply)", `
        <div class="grid sm:grid-cols-2 gap-2">
          ${checkboxes('growth', [
            'Therapy or counselling',
            'Meditation or mindfulness practices',
            'Reading (self-help, philosophy)',
            'Meaningful friendships',
            'Travel or new cultural experiences',
            'Overcoming a major life challenge',
            'Creative expression (art, music, writing)'
          ])}
        </div>
      `),

      step('energised', "What makes you feel energised and alive?", `<textarea class="input" name="energised" rows="4"></textarea>`),

      step('happy_memory', "One of your happiest memories?", `<textarea class="input" name="happy_memory" rows="4"></textarea>`),

      step('humour', "How would you describe your sense of humour?", `<textarea class="input" name="humour" rows="3"></textarea>`),

      step('belief_change', "A belief you once held strongly but changed—why?", `<textarea class="input" name="belief_change" rows="4"></textarea>`),

      step('helped', "How have you helped someone recently? Is this part of daily life?", `<textarea class="input" name="helped" rows="4"></textarea>`),

      step('future', "How do you see your future? Plans for coming months/years?", `<textarea class="input" name="future" rows="4"></textarea>`),

      step('practices', "Mindfulness or health practices? How often?", `<textarea class="input" name="practices" rows="4" placeholder="Yoga, meditation, gym, sauna, etc."></textarea>`),

      // Partner — importance set 1
      step('importance1', "In a partner, how important are the following to you?", `
        <div class="space-y-3">
          ${rangeRow('imp_financial', 'Financial Security')}
          ${rangeRow('imp_appearance', 'Physical Appearance')}
          ${rangeRow('imp_style', 'Sense of Style')}
          ${rangeRow('imp_fitness', 'Physical Fitness & Health')}
          ${rangeRow('imp_ambition', 'Career Ambition')}
        </div>
        <p class="help mt-2">Scale: 1 = not important, 5 = very important.</p>
      `),

      // Partner — importance set 2
      step('importance2', "And how about these?", `
        <div class="space-y-3">
          ${rangeRow('imp_ei', 'Emotional Intelligence')}
          ${rangeRow('imp_comm', 'Communication')}
          ${rangeRow('imp_selfaware', 'Self-Awareness')}
          ${rangeRow('imp_humour', 'Humour')}
          ${rangeRow('imp_kindness', 'Kindness')}
          ${rangeRow('imp_openness', 'Openness')}
        </div>
        <p class="help mt-2">Scale: 1 = not important, 5 = very important.</p>
      `),

      step('partner_most', "What is most important to you in a partner?", `<textarea class="input" name="partner_most" rows="4"></textarea>`),

      step('attracted_to', "What are you normally attracted to? Open to new types?", `<textarea class="input" name="attracted_to" rows="4"></textarea>`),

      step('admire', "A quality you consistently admire in others?", `<textarea class="input" name="admire" rows="3"></textarea>`),

      step('foundation', "Describe a foundational quality of a strong, healthy relationship.", `<textarea class="input" name="foundation" rows="4"></textarea>`),

      step('safe', "What does ‘feeling safe’ in a connection mean to you?", `<textarea class="input" name="safe" rows="4"></textarea>`),

      step('lessons', "What have you learned from past relationships? Good and bad.", `<textarea class="input" name="lessons" rows="4"></textarea>`),

      step('love_language', "What is your love language?", `
        <select class="input" name="love_language">
          <option value="">Select one (optional)</option>
          <option>Words of Affirmation</option>
          <option>Acts of Service</option>
          <option>Receiving Gifts</option>
          <option>Quality Time</option>
          <option>Physical Touch</option>
        </select>
      `),

      // Anything else + Address
      step('anything_else', "Anything else you would like to share?", `<textarea class="input" name="anything_else" rows="4"></textarea>`),

      step('address', "And finally, your address (kept confidential).", `
        <textarea class="input" name="address" rows="3" placeholder="Street, City, Postal Code, Country"></textarea>
        <p class="help mt-2">This will not be shared with anyone you are matched with. Letters are routed through us and forwarded to you.</p>
      `),
    ];

    let CURRENT_INDEX = 0;
    const RESPONSES = JSON.parse(localStorage.getItem('responses') || '{}');

    function initWizard() {
      // If wizard already visible (avoid re-init)
      const qSection = document.getElementById('questions');
      if (!qSection || !qSection.classList.contains('hidden')) { /* continue */ }
      renderStep(0);
    }

    const qForm = document.getElementById('q-form');
    const qBody = document.getElementById('q-body');
    const qBack = document.getElementById('q-back');
    const qSkip = document.getElementById('q-skip');
    const qNext = document.getElementById('q-next');
    const qProgressBar = document.getElementById('q-progress-bar');
    const qProgressLabel = document.getElementById('q-progress-label');
    const qReview = document.getElementById('q-review');
    const qReviewList = document.getElementById('q-review-list');
    const qSubmit = document.getElementById('q-submit');

    function updateProgress() {
      const total = QUESTIONS.length;
      const current = Math.min(CURRENT_INDEX + 1, total);
      const pct = Math.round((CURRENT_INDEX) / total * 100);
      qProgressBar.style.width = pct + '%';
      qProgressLabel.textContent = `Question ${current} of ${total}`;
      qBack.disabled = CURRENT_INDEX === 0;
    }

    function renderStep(index) {
      CURRENT_INDEX = index;
      qReview.classList.add('hidden');
      qForm.classList.remove('hidden');

      const s = QUESTIONS[index];
      qBody.innerHTML = `
        <label class="label">${s.label}</label>
        ${s.html}
        ${s.help ? `<p class="help">${s.help}</p>` : ''}
      `;
      // Restore saved value(s)
      restoreValues(s.id);
      updateProgress();

      // Button labels
      qNext.textContent = (index === QUESTIONS.length - 1) ? 'Review' : 'Next';
    }

    function gatherValues(stepId) {
      const data = {};
      const fields = qBody.querySelectorAll('input, textarea, select');
      fields.forEach(f => {
        if (f.type === 'radio') {
          if (f.checked) data[f.name] = f.value;
        } else if (f.type === 'checkbox') {
          if (!data[f.name]) data[f.name] = [];
          if (f.checked) data[f.name].push(f.value);
        } else {
          data[f.name] = f.value;
        }
      });
      RESPONSES[stepId] = data;
      localStorage.setItem('responses', JSON.stringify(RESPONSES));
    }

    function restoreValues(stepId) {
      const saved = RESPONSES[stepId] || {};
      const fields = qBody.querySelectorAll('input, textarea, select');
      fields.forEach(f => {
        if (f.type === 'radio') {
          f.checked = saved[f.name] === f.value;
        } else if (f.type === 'checkbox') {
          const arr = saved[f.name] || [];
          f.checked = Array.isArray(arr) && arr.includes(f.value);
        } else {
          if (saved[f.name] !== undefined) f.value = saved[f.name];
        }
      });
    }

    qBack?.addEventListener('click', () => {
      if (CURRENT_INDEX > 0) renderStep(CURRENT_INDEX - 1);
    });

    qSkip?.addEventListener('click', () => {
      // Save empty (skip)
      RESPONSES[QUESTIONS[CURRENT_INDEX].id] = RESPONSES[QUESTIONS[CURRENT_INDEX].id] || {};
      localStorage.setItem('responses', JSON.stringify(RESPONSES));
      if (CURRENT_INDEX < QUESTIONS.length - 1) renderStep(CURRENT_INDEX + 1);
      else showReview();
    });

    qForm?.addEventListener('submit', (e) => {
      e.preventDefault();
      const s = QUESTIONS[CURRENT_INDEX];
      // Basic required check: if any element has required, ensure not empty
      const hasRequired = qBody.querySelector('[required]');
      if (hasRequired && !qForm.checkValidity()) {
        qForm.reportValidity();
        return;
      }
      gatherValues(s.id);
      if (CURRENT_INDEX < QUESTIONS.length - 1) renderStep(CURRENT_INDEX + 1);
      else showReview();
    });

    function showReview() {
      qForm.classList.add('hidden');
      qReview.classList.remove('hidden');
      qProgressBar.style.width = '100%';
      qProgressLabel.textContent = `Review & Submit`;

      const items = [];
      for (const step of QUESTIONS) {
        const entry = RESPONSES[step.id] || {};
        const pretty = Object.entries(entry).map(([k, v]) => {
          if (Array.isArray(v)) return `<div><span class="pill mr-1">${v.join('</span> <span class="pill mr-1">')}</span></div>`;
          return `<div><span class="text-[var(--muted)]">${k}:</span> ${String(v || '')}</div>`;
        }).join('') || '<div class="text-[var(--muted)]">— skipped —</div>';
        items.push(`
          <div class="p-4 border border-gray-200 rounded-lg">
            <div class="font-semibold mb-1">${step.label}</div>
            ${pretty}
          </div>
        `);
      }
      qReviewList.innerHTML = items.join('');
    }

    qSubmit?.addEventListener('click', async () => {
      // Placeholder submit
      console.log('Signup email:', localStorage.getItem('signup_email'));
      console.log('Responses:', RESPONSES);
      alert('Thank you! Your profile has been recorded (demo). We will email you the next steps.');
      // Clear demo storage
      localStorage.removeItem('responses');
      localStorage.removeItem('is_signup_complete');
      // Navigate back to top
      window.location.hash = '#top';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // If user reloads on #questions and already signed up, re-init
    if (location.hash === '#questions' && localStorage.getItem('is_signup_complete') === 'true') {
      document.getElementById('questions').classList.remove('hidden');
      initWizard();
    }
  </script>
</body>
</html>
